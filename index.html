<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìš´ëª… ë§ì¶¤ í˜¸ìŠ¤íŒ… - Airbnb Saju Matching System</title>
  <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
      color: #e8e6e3;
    }

    .app {
      min-height: 100vh;
    }

    .header {
      background: rgba(20, 25, 35, 0.95);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo svg {
      color: #f4a261;
      animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes sparkle {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.7;
        transform: scale(1.1);
      }
    }

    .logo h1 {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.02em;
    }

    .logo p {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 0.125rem;
      letter-spacing: 0.05em;
    }

    .nav {
      display: flex;
      gap: 0.5rem;
    }

    .nav button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .nav button:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .nav button.active {
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      border-color: transparent;
      color: #fff;
    }

    .main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* Dashboard */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(244, 162, 97, 0.3);
      transform: translateY(-2px);
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.5rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
    }

    .quick-actions {
      display: flex;
      gap: 1rem;
      margin-bottom: 3rem;
    }

    .primary-btn,
    .secondary-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      border-radius: 14px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      flex: 1;
    }

    .primary-btn {
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      color: #fff;
    }

    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
    }

    .secondary-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.9);
    }

    .secondary-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #fff;
    }

    .rooms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .room-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .room-card:hover {
      transform: translateY(-4px);
      border-color: rgba(244, 162, 97, 0.3);
      box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);
    }

    .room-header {
      padding: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .room-emoji {
      font-size: 3rem;
    }

    .room-element {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
    }

    .room-body {
      padding: 1.5rem 2rem 2rem;
    }

    .room-number {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 0.25rem;
      letter-spacing: 0.05em;
    }

    .room-name {
      font-size: 1.25rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 0.75rem;
    }

    .room-description {
      color: rgba(255, 255, 255, 0.7);
      line-height: 1.6;
      margin-bottom: 1.25rem;
    }

    .room-features {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .feature-tag {
      padding: 0.4rem 0.75rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.8);
    }

    /* Check-in View */
    .checkin-view {
      max-width: 600px;
      margin: 2rem auto;
    }

    .form-container {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 3rem;
    }

    .form-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .form-subtitle {
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 2.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 1rem 1.25rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #f4a261;
      background: rgba(255, 255, 255, 0.08);
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .birth-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 1rem;
    }

    .time-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .calendar-type-selector {
      display: flex;
      gap: 0.75rem;
    }

    .calendar-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.9);
    }

    .calendar-btn.active {
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      border-color: transparent;
      color: #fff;
    }

    .calendar-btn svg {
      flex-shrink: 0;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2.5rem;
    }

    .result-view {
      max-width: 1000px;
      margin: 0 auto;
    }

    .result-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .result-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #fff;
    }

    .result-subtitle {
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.1rem;
    }

    /* Saju Analysis Section */
    .saju-analysis {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 2.5rem;
      margin-bottom: 2rem;
    }

    .analysis-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #fff;
    }

    .element-chart {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 16px;
    }

    .element-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .element-bar-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
    }

    .element-bar-container {
      width: 100%;
      height: 120px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      overflow: hidden;
    }

    .element-bar-fill {
      width: 100%;
      border-radius: 8px 8px 0 0;
      transition: height 0.6s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #fff;
      font-size: 1.25rem;
    }

    .balance-tip {
      margin-bottom: 2rem;
    }

    .personality-section h4,
    .fortune-section h4,
    .balance-tip h4,
    .daily-fortune h4 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #f4a261;
    }

    .personality-section p,
    .balance-tip p {
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.8;
      font-size: 1.05rem;
    }

    .daily-fortune {
      margin-top: 2rem;
    }

    .daily-fortune-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }

    .daily-fortune-item {
      background: linear-gradient(135deg, rgba(244, 162, 97, 0.05) 0%, rgba(231, 111, 81, 0.05) 100%);
      border: 1px solid rgba(244, 162, 97, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .daily-fortune-item:hover {
      background: linear-gradient(135deg, rgba(244, 162, 97, 0.1) 0%, rgba(231, 111, 81, 0.1) 100%);
      border-color: rgba(244, 162, 97, 0.4);
      transform: translateY(-2px);
    }

    .fortune-emoji {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .fortune-title {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.75rem;
    }

    .fortune-stars {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      letter-spacing: 0.25rem;
    }

    .fortune-message {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.5;
    }

    .fortune-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .fortune-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .fortune-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(244, 162, 97, 0.3);
      transform: translateY(-2px);
    }

    .fortune-icon {
      font-size: 2rem;
      margin-bottom: 0.75rem;
    }

    .fortune-label {
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .fortune-value {
      color: #f4a261;
      font-weight: 700;
      font-size: 1.1rem;
    }

    .result-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .result-room,
    .welcome-guide {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 24px;
      padding: 2rem;
    }

    .room-showcase {
      border-radius: 16px;
      padding: 2.5rem;
      text-align: center;
      margin-bottom: 2rem;
    }

    .room-showcase-emoji {
      font-size: 5rem;
      margin-bottom: 1rem;
    }

    .room-showcase-number {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.5rem;
    }

    .room-showcase-name {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 1rem;
    }

    .room-showcase-element {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: #fff;
      font-weight: 600;
    }

    .matching-reason,
    .room-features-list {
      margin-bottom: 2rem;
    }

    .matching-reason h3,
    .room-features-list h3 {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: #fff;
    }

    .matching-reason p {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.7;
    }

    .room-features-list ul {
      list-style: none;
    }

    .room-features-list li {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 0;
      color: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .room-features-list li:last-child {
      border-bottom: none;
    }

    .guide-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.3rem;
      margin-bottom: 2rem;
      color: #fff;
    }

    .guide-section {
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .guide-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 0.5rem;
    }

    .guide-value {
      color: #fff;
      font-weight: 600;
      font-size: 1.05rem;
    }

    .guide-tip {
      margin-top: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, rgba(244, 162, 97, 0.1) 0%, rgba(231, 111, 81, 0.1) 100%);
      border: 1px solid rgba(244, 162, 97, 0.2);
      border-radius: 12px;
    }

    .guide-tip strong {
      display: block;
      color: #f4a261;
      margin-bottom: 0.5rem;
    }

    .guide-tip p {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
    }

    .result-actions {
      display: flex;
      gap: 1rem;
    }

    /* History View */
    .history-view {
      max-width: 1000px;
      margin: 0 auto;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .history-header h2 {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
    }

    .search-box {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      width: 300px;
    }

    .search-box input {
      flex: 1;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 0.9rem;
      outline: none;
    }

    .search-box input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .history-list {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 1rem;
      margin-bottom: 2rem;
      min-height: 400px;
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 400px;
      color: rgba(255, 255, 255, 0.4);
      gap: 1rem;
    }

    .history-item {
      display: grid;
      grid-template-columns: 2fr 2fr 1.5fr auto;
      gap: 2rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      margin-bottom: 1rem;
      align-items: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .history-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(244, 162, 97, 0.2);
      transform: translateX(4px);
    }

    .view-analysis-btn {
      color: #f4a261;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(244, 162, 97, 0.1);
      border-radius: 10px;
      transition: all 0.3s ease;
    }

    .history-item:hover .view-analysis-btn {
      background: rgba(244, 162, 97, 0.2);
      transform: translateX(4px);
    }

    .history-guest {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .history-avatar {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
    }

    .history-name {
      font-weight: 600;
      color: #fff;
      margin-bottom: 0.25rem;
    }

    .history-date {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .history-room {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .history-room-badge {
      padding: 0.5rem 1rem;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #fff;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .history-room-name {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    .history-element {
      text-align: right;
    }

    .element-label {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 0.5rem;
    }

    .element-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 600;
    }

    .history-actions {
      display: flex;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .nav {
        width: 100%;
        justify-content: space-between;
      }

      .nav button {
        flex: 1;
        justify-content: center;
        font-size: 0.85rem;
        padding: 0.65rem 0.75rem;
      }

      .result-container {
        grid-template-columns: 1fr;
      }

      .birth-grid {
        grid-template-columns: 1fr 1fr 1fr;
      }

      .time-grid {
        grid-template-columns: 1fr 1fr;
      }

      .fortune-cards {
        grid-template-columns: 1fr;
      }

      .daily-fortune-grid {
        grid-template-columns: 1fr;
      }

      .element-chart {
        grid-template-columns: repeat(5, 1fr);
        gap: 0.5rem;
        padding: 1rem;
      }

      .element-bar-container {
        height: 80px;
      }

      .history-item {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .history-element {
        text-align: left;
      }

      .view-analysis-btn {
        margin: 0 auto;
      }
    }

    @media print {

      .header,
      .nav,
      .result-actions,
      .history-actions {
        display: none;
      }

      body {
        background: white;
        color: black;
      }

      .result-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
          </svg>
          <div>
            <h1>ìš´ëª… ë§ì¶¤ í˜¸ìŠ¤íŒ…</h1>
            <p>Airbnb Saju Matching System</p>
          </div>
        </div>

        <nav class="nav">
          <button class="active" onclick="showView('dashboard')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
              <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            ëŒ€ì‹œë³´ë“œ
          </button>
          <button onclick="showView('checkin')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19" />
              <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            ì²´í¬ì¸
          </button>
          <button onclick="showView('history')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            ì´ë ¥
          </button>
        </nav>
      </div>
    </header>

    <main class="main">
      <!-- Dashboard View -->
      <div id="dashboard" class="view active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">ğŸ‘¤</div>
            <div class="stat-content">
              <div class="stat-label">ì´ ê²ŒìŠ¤íŠ¸</div>
              <div class="stat-value" id="totalGuests">0</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">ğŸ </div>
            <div class="stat-content">
              <div class="stat-label">ê°ì‹¤ ìˆ˜</div>
              <div class="stat-value">5</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">âœ¨</div>
            <div class="stat-content">
              <div class="stat-label">ë§¤ì¹­ ì™„ë£Œ</div>
              <div class="stat-value" id="totalMatches">0</div>
            </div>
          </div>
        </div>

        <div class="quick-actions">
          <button class="primary-btn" onclick="showView('checkin')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19" />
              <line x1="5" y1="12" x2="19" y2="12" />
            </svg>
            ìƒˆ ê²ŒìŠ¤íŠ¸ ì²´í¬ì¸
          </button>
          <button class="secondary-btn" onclick="showView('history')">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            ê²ŒìŠ¤íŠ¸ ì´ë ¥
          </button>
        </div>

        <div class="rooms-section">
          <h2 class="section-title">ê°ì‹¤ í˜„í™©</h2>
          <div class="rooms-grid" id="roomsGrid"></div>
        </div>
      </div>

      <!-- Check-in View -->
      <div id="checkin" class="view">
        <div class="checkin-view">
          <div class="form-container">
            <h2 class="form-title">ê²ŒìŠ¤íŠ¸ ì²´í¬ì¸</h2>
            <p class="form-subtitle">ê²ŒìŠ¤íŠ¸ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ ìµœì ì˜ ê°ì‹¤ì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤</p>

            <div class="form-group">
              <label>ì„±í•¨</label>
              <input type="text" id="guestName" class="form-input" placeholder="í™ê¸¸ë™">
            </div>

            <div class="form-group">
              <label>ìƒë…„ì›”ì¼ ê¸°ì¤€</label>
              <div class="calendar-type-selector">
                <button type="button" class="calendar-btn active" id="solarBtn" onclick="selectCalendarType('solar')">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <line x1="12" y1="1" x2="12" y2="3" />
                    <line x1="12" y1="21" x2="12" y2="23" />
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                    <line x1="1" y1="12" x2="3" y2="12" />
                    <line x1="21" y1="12" x2="23" y2="12" />
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                  </svg>
                  ì–‘ë ¥
                </button>
                <button type="button" class="calendar-btn" id="lunarBtn" onclick="selectCalendarType('lunar')">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                  </svg>
                  ìŒë ¥
                </button>
              </div>
            </div>

            <div class="birth-grid">
              <div class="form-group">
                <label>ìƒë…„</label>
                <input type="number" id="birthYear" class="form-input" placeholder="1990" min="1900" max="2024"
                  step="1">
              </div>

              <div class="form-group">
                <label>ì›”</label>
                <input type="number" id="birthMonth" class="form-input" placeholder="6" min="1" max="12" step="1">
              </div>

              <div class="form-group">
                <label>ì¼</label>
                <input type="number" id="birthDay" class="form-input" placeholder="15" min="1" max="31" step="1">
              </div>
            </div>

            <div class="time-grid">
              <div class="form-group">
                <label>ì‹œ (24ì‹œê°„)</label>
                <input type="number" id="birthHour" class="form-input" placeholder="14" min="0" max="23" step="1">
              </div>

              <div class="form-group">
                <label>ë¶„</label>
                <input type="number" id="birthMinute" class="form-input" placeholder="30" min="0" max="59" step="1">
              </div>
            </div>

            <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
              <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.9rem;">
                <input type="checkbox" id="timeUnknown" style="margin-right: 0.5rem; cursor: pointer;"
                  onchange="toggleTimeInput()">
                <span>ì¶œìƒ ì‹œê°„ì„ ëª¨ë¥´ê² ì–´ìš” (ì‹œì£¼ ì œì™¸)</span>
              </label>
            </div>

            <div class="form-actions">
              <button class="secondary-btn" onclick="showView('dashboard')">ì·¨ì†Œ</button>
              <button class="primary-btn" onclick="handleCheckIn()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                ë§¤ì¹­í•˜ê¸°
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Result View -->
      <div id="result" class="view">
        <div class="result-view">
          <div class="result-header">
            <h2 class="result-title" id="resultGuestName"></h2>
            <p class="result-subtitle">ì‚¬ì£¼ ë¶„ì„ì„ í†µí•´ ìµœì ì˜ ê³µê°„ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤</p>
          </div>

          <!-- Saju Analysis Section -->
          <div class="saju-analysis">
            <h3 class="analysis-title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 6v6l4 2" />
              </svg>
              ë‹¹ì‹ ì˜ ì‚¬ì£¼ ë¶„ì„
            </h3>

            <div class="element-chart" id="elementChart"></div>

            <div class="personality-section">
              <h4>ğŸŒŸ ì„±ê²© ë° ê¸°ì§ˆ</h4>
              <p id="personalityText"></p>
            </div>

            <div class="fortune-section">
              <h4>âœ¨ ì´ë²ˆ ìˆ™ë°•ì—ì„œ ê¸°ëŒ€í•  ìˆ˜ ìˆëŠ” ê²ƒ</h4>
              <div class="fortune-cards" id="fortuneCards"></div>
            </div>

            <div class="balance-tip">
              <h4>âš–ï¸ ì˜¤í–‰ ê· í˜• ì¡°ì–¸</h4>
              <p id="balanceTip"></p>
            </div>

            <div class="daily-fortune">
              <h4>ğŸ”® ì˜¤ëŠ˜ì˜ ìš´ì„¸</h4>
              <div class="daily-fortune-grid">
                <div class="daily-fortune-item">
                  <div class="fortune-emoji">ğŸ’–</div>
                  <div class="fortune-title">ì—°ì• ìš´</div>
                  <div class="fortune-stars" id="loveStars"></div>
                  <div class="fortune-message" id="loveMessage"></div>
                </div>
                <div class="daily-fortune-item">
                  <div class="fortune-emoji">ğŸ’¼</div>
                  <div class="fortune-title">ì‚¬ì—…/í•™ì—…ìš´</div>
                  <div class="fortune-stars" id="careerStars"></div>
                  <div class="fortune-message" id="careerMessage"></div>
                </div>
                <div class="daily-fortune-item">
                  <div class="fortune-emoji">ğŸ’°</div>
                  <div class="fortune-title">ê¸ˆì „ìš´</div>
                  <div class="fortune-stars" id="moneyStars"></div>
                  <div class="fortune-message" id="moneyMessage"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="result-container">
            <div class="result-room">
              <div class="room-showcase" id="roomShowcase">
                <div class="room-showcase-emoji" id="roomShowcaseEmoji"></div>
                <div class="room-showcase-info">
                  <div class="room-showcase-number" id="roomShowcaseNumber"></div>
                  <div class="room-showcase-name" id="roomShowcaseName"></div>
                  <div class="room-showcase-element" id="roomShowcaseElement"></div>
                </div>
              </div>

              <div class="matching-reason">
                <h3>ë§¤ì¹­ ì´ìœ </h3>
                <p id="matchingReason"></p>
              </div>

              <div class="room-features-list">
                <h3>ê°ì‹¤ íŠ¹ì§•</h3>
                <ul id="roomFeaturesList"></ul>
              </div>
            </div>

            <div class="welcome-guide">
              <h3 class="guide-title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                ê°œìš´ ì›°ì»´ ê°€ì´ë“œ
              </h3>

              <div class="guide-section">
                <div class="guide-label">ì¶”ì²œ ì›°ì»´ í‹°</div>
                <div class="guide-value" id="welcomeTea"></div>
              </div>

              <div class="guide-section">
                <div class="guide-label">ì•„ë¡œë§ˆ í–¥</div>
                <div class="guide-value" id="welcomeAroma"></div>
              </div>

              <div class="guide-section">
                <div class="guide-label">ì¶”ì²œ í™œë™</div>
                <div class="guide-value" id="welcomeActivity"></div>
              </div>

              <div class="guide-section">
                <div class="guide-label">ì¹¨ëŒ€ ë°©í–¥</div>
                <div class="guide-value" id="welcomeDirection"></div>
              </div>

              <div class="guide-section">
                <div class="guide-label">í–‰ìš´ì˜ ì»¬ëŸ¬</div>
                <div class="guide-value" id="welcomeColor"></div>
              </div>

              <div class="guide-tip">
                <strong>ğŸ’¡ ìˆ™ë°• íŒ</strong>
                <p id="welcomeTip"></p>
              </div>
            </div>
          </div>

          <div class="result-actions">
            <button class="secondary-btn" onclick="showView('dashboard')">ëŒ€ì‹œë³´ë“œë¡œ</button>
            <button class="primary-btn" onclick="window.print()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
                <line x1="16" y1="13" x2="8" y2="13" />
                <line x1="16" y1="17" x2="8" y2="17" />
                <polyline points="10 9 9 9 8 9" />
              </svg>
              ê°€ì´ë“œ ì¶œë ¥
            </button>
          </div>
        </div>
      </div>

      <!-- History View -->
      <div id="history" class="view">
        <div class="history-view">
          <div class="history-header">
            <h2>ê²ŒìŠ¤íŠ¸ ì´ë ¥</h2>
            <div class="search-box">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
              </svg>
              <input type="text" id="searchInput" placeholder="ê²ŒìŠ¤íŠ¸ ì´ë¦„ ê²€ìƒ‰..." oninput="filterGuests()">
            </div>
          </div>

          <div class="history-list" id="historyList"></div>

          <div class="history-actions">
            <button class="secondary-btn" onclick="showView('dashboard')">ëŒ€ì‹œë³´ë“œë¡œ</button>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    // Data
    const ROOMS = {
      101: {
        id: 101,
        name: 'The Forest',
        nameKo: 'ìˆ²ì˜ ë°©',
        element: 'WOOD',
        elementKo: 'æœ¨',
        description: 'í¸ë°±ë‚˜ë¬´ ìš•ì¡°ì™€ í”Œëœí…Œë¦¬ì–´ê°€ ì–´ìš°ëŸ¬ì§„ ìì—°ì˜ ë°©',
        features: ['í¸ë°±ë‚˜ë¬´ ìš•ì¡°', 'í”Œëœí…Œë¦¬ì–´', 'ìì—°ê´‘', 'ëª©ì¬ ê°€êµ¬'],
        color: '#2d5016',
        bgGradient: 'linear-gradient(135deg, #1a3d0c 0%, #4a7c2e 100%)',
        image: 'ğŸŒ²'
      },
      102: {
        id: 102,
        name: 'The Sun',
        nameKo: 'íƒœì–‘ì˜ ë°©',
        element: 'FIRE',
        elementKo: 'ç«',
        description: 'ë”°ëœ»í•œ ë²½ë‚œë¡œì™€ ì›œí†¤ ì¡°ëª…ì˜ ì—ë„ˆì§€ ë„˜ì¹˜ëŠ” ê³µê°„',
        features: ['ì „ê¸° ë²½ë‚œë¡œ', 'ë‚¨í–¥ ì±„ê´‘', 'ì›œí†¤ ì¡°ëª…', 'ë ˆë“œ ì•¡ì„¼íŠ¸'],
        color: '#c84b31',
        bgGradient: 'linear-gradient(135deg, #8b2e1f 0%, #d4693d 100%)',
        image: 'ğŸ”¥'
      },
      201: {
        id: 201,
        name: 'The Earth',
        nameKo: 'ëŒ€ì§€ì˜ ë°©',
        element: 'EARTH',
        elementKo: 'åœŸ',
        description: 'í™©í† ë°© ìŠ¤íƒ€ì¼ì˜ ì•ˆì •ì ì´ê³  í¬ê·¼í•œ ê³µê°„',
        features: ['í™©í† ë²½', 'ë‚®ì€ ì¹¨ëŒ€', 'ì–´ìŠ¤í†¤ ì¸í…Œë¦¬ì–´', 'ëª…ìƒ ê³µê°„'],
        color: '#8d6e4f',
        bgGradient: 'linear-gradient(135deg, #5c4a33 0%, #a68968 100%)',
        image: 'â›°ï¸'
      },
      202: {
        id: 202,
        name: 'The Atelier',
        nameKo: 'ì•„í‹€ë¦¬ì—',
        element: 'METAL',
        elementKo: 'é‡‘',
        description: 'ëª¨ë˜í•˜ê³  ì„¸ë ¨ëœ ê¸ˆì†ì˜ ë¯¸í•™',
        features: ['ë©”íƒˆ ê°€êµ¬', 'í™”ì´íŠ¸ ë…¸ì´ì¦ˆ', 'ë¯¸ë‹ˆë©€ ë””ìì¸', 'ê³ ê¸‰ ì¹¨êµ¬'],
        color: '#7a7a7a',
        bgGradient: 'linear-gradient(135deg, #4a4a4a 0%, #9a9a9a 100%)',
        image: 'âš¡'
      },
      301: {
        id: 301,
        name: 'The Ocean',
        nameKo: 'ë°”ë‹¤ì˜ ë°©',
        element: 'WATER',
        elementKo: 'æ°´',
        description: 'ë¬¼ì†Œë¦¬ì™€ ë„¤ì´ë¹„ ì¹¨êµ¬ì˜ í‰ì˜¨í•œ íœ´ì‹ì²˜',
        features: ['ë¬¼ì†Œë¦¬ ì‚¬ìš´ë“œ', 'ë„¤ì´ë¹„ ì¹¨êµ¬', 'ì˜¤ì…˜ ë·°', 'ê°€ìŠµê¸°'],
        color: '#2c5f8d',
        bgGradient: 'linear-gradient(135deg, #1a3a5c 0%, #3d7aa8 100%)',
        image: 'ğŸŒŠ'
      }
    };

    const WELCOME_ITEMS = {
      WOOD: {
        tea: 'ë…¹ì°¨ / ë§¤ì‹¤ì°¨',
        aroma: 'í”¼í†¤ì¹˜ë“œ / ì†”í–¥',
        activity: 'ë…ì„œ / ì‚°ë¦¼ìš•',
        direction: 'ë™ìª½',
        color: 'ì´ˆë¡ìƒ‰'
      },
      FIRE: {
        tea: 'êµ¬ê¸°ìì°¨ / í™ì°¨',
        aroma: 'ë¡œì¦ˆë§ˆë¦¬ / ì‹œë‚˜ëª¬',
        activity: 'ì¼ê´‘ìš• / í™œê¸°ì°¬ í™œë™',
        direction: 'ë‚¨ìª½',
        color: 'ë¹¨ê°•ìƒ‰'
      },
      EARTH: {
        tea: 'í™©ê¸°ì°¨ / ëŒ€ì¶”ì°¨',
        aroma: 'ìƒŒë‹¬ìš°ë“œ / ë°±ë‹¨í–¥',
        activity: 'ëª…ìƒ / ìš”ê°€',
        direction: 'ë‚¨ì„œìª½ / ë™ë¶ìª½',
        color: 'í™©ìƒ‰'
      },
      METAL: {
        tea: 'ë„ë¼ì§€ì°¨ / ìƒê°•ì°¨',
        aroma: 'ìœ ì¹¼ë¦½íˆ¬ìŠ¤ / í˜í¼ë¯¼íŠ¸',
        activity: 'ì •ë¦¬ì •ëˆ / ì‚¬ìƒ‰',
        direction: 'ì„œìª½',
        color: 'í°ìƒ‰'
      },
      WATER: {
        tea: 'ê²°ëª…ìì°¨ / ì˜¥ìˆ˜ìˆ˜ì°¨',
        aroma: 'ë¼ë²¤ë” / ì¬ìŠ¤ë¯¼',
        activity: 'ìŒì•…ê°ìƒ / íœ´ì‹',
        direction: 'ë¶ìª½',
        color: 'ê²€ì •/íŒŒë‘'
      }
    };

    const ELEMENT_PERSONALITIES = {
      WOOD: {
        strong: 'ì°½ì˜ì ì´ê³  ì„±ì¥ì§€í–¥ì ì¸ ì„±ê²©ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì‹œì‘ê³¼ ë„ì „ì„ ì¦ê¸°ë©°, ìœ ì—°í•œ ì‚¬ê³ ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.',
        weak: 'ëª©ê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ë•Œë¡œëŠ” ìš°ìœ ë¶€ë‹¨í•˜ê±°ë‚˜ ì„±ì¥ ë™ë ¥ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        color: '#4a7c2e'
      },
      FIRE: {
        strong: 'ì—´ì •ì ì´ê³  ì¹´ë¦¬ìŠ¤ë§ˆ ë„˜ì¹˜ëŠ” ì„±ê²©ì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ì—ê²Œ ì—ë„ˆì§€ë¥¼ ì£¼ë©°, ë¦¬ë”ì‹­ê³¼ ì¶”ì§„ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.',
        weak: 'í™”ê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ì—´ì •ì´ë‚˜ ì¶”ì§„ë ¥ì´ ë‹¤ì†Œ ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        color: '#d4693d'
      },
      EARTH: {
        strong: 'ì•ˆì •ì ì´ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì„±ê²©ì…ë‹ˆë‹¤. í¬ìš©ë ¥ì´ ìˆê³  í˜„ì‹¤ì ì´ë©°, íƒ€ì¸ì„ í¸ì•ˆí•˜ê²Œ í•©ë‹ˆë‹¤.',
        weak: 'í† ê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ë¶ˆì•ˆì •í•˜ê±°ë‚˜ ê·¼ê±°ê°€ ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        color: '#a68968'
      },
      METAL: {
        strong: 'ì›ì¹™ì ì´ê³  ë¶„ì„ì ì¸ ì„±ê²©ì…ë‹ˆë‹¤. ë…¼ë¦¬ì ì´ë©° ì •ì˜ë¡œìš°ë©°, ëª…í™•í•œ ê¸°ì¤€ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.',
        weak: 'ê¸ˆê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ê²°ë‹¨ë ¥ì´ë‚˜ ì›ì¹™ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        color: '#9a9a9a'
      },
      WATER: {
        strong: 'ì§€í˜œë¡­ê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚œ ì„±ê²©ì…ë‹ˆë‹¤. í†µì°°ë ¥ì´ ìˆê³  ìœ ì—°í•˜ë©°, íë¦„ì„ ì½ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤.',
        weak: 'ìˆ˜ê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ì§€í˜œë‚˜ ìœ ì—°ì„±ì´ ë‹¤ì†Œ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        color: '#3d7aa8'
      }
    };

    const FORTUNE_MESSAGES = {
      WOOD: {
        health: { icon: 'ğŸŒ±', label: 'ê±´ê°•ìš´', value: 'í™œë ¥ ì¶©ì „' },
        wealth: { icon: 'ğŸ’°', label: 'ì¬ë¬¼ìš´', value: 'ì„±ì¥ì˜ ê¸°íšŒ' },
        relationship: { icon: 'ğŸ’š', label: 'ì¸ê°„ê´€ê³„', value: 'ìƒˆë¡œìš´ ì¸ì—°' }
      },
      FIRE: {
        health: { icon: 'ğŸ”¥', label: 'ê±´ê°•ìš´', value: 'ì—ë„ˆì§€ ìƒìŠ¹' },
        wealth: { icon: 'ğŸ’', label: 'ì¬ë¬¼ìš´', value: 'ì—´ì •ì˜ ê²°ì‹¤' },
        relationship: { icon: 'â¤ï¸', label: 'ì¸ê°„ê´€ê³„', value: 'ë¦¬ë”ì‹­ ë°œíœ˜' }
      },
      EARTH: {
        health: { icon: 'â›°ï¸', label: 'ê±´ê°•ìš´', value: 'ì•ˆì •ê³¼ íšŒë³µ' },
        wealth: { icon: 'ğŸ†', label: 'ì¬ë¬¼ìš´', value: 'ì°©ì‹¤í•œ ì¶•ì ' },
        relationship: { icon: 'ğŸ¤', label: 'ì¸ê°„ê´€ê³„', value: 'ì‹ ë¢° êµ¬ì¶•' }
      },
      METAL: {
        health: { icon: 'âš¡', label: 'ê±´ê°•ìš´', value: 'ì •í™”ì™€ ì •ëˆ' },
        wealth: { icon: 'ğŸ’«', label: 'ì¬ë¬¼ìš´', value: 'ëª…í™•í•œ ë°©í–¥' },
        relationship: { icon: 'ğŸ¯', label: 'ì¸ê°„ê´€ê³„', value: 'ì›ì¹™ ìˆëŠ” ê´€ê³„' }
      },
      WATER: {
        health: { icon: 'ğŸ’§', label: 'ê±´ê°•ìš´', value: 'ìˆœí™˜ê³¼ íœ´ì‹' },
        wealth: { icon: 'ğŸŒŠ', label: 'ì¬ë¬¼ìš´', value: 'íë¦„ì„ íƒ€ë¼' },
        relationship: { icon: 'ğŸ’™', label: 'ì¸ê°„ê´€ê³„', value: 'ê¹Šì€ ì´í•´' }
      }
    };

    const BALANCE_TIPS = {
      WOOD: 'ëª©(æœ¨)ê¸°ìš´ì„ ë³´ì¶©í•˜ë©´ ì°½ì˜ì„±ê³¼ ì„±ì¥ ë™ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤. ì´ ë°©ì—ì„œ ìƒˆë¡œìš´ ì•„ì´ë””ì–´ê°€ ë– ì˜¤ë¥´ê±°ë‚˜, ë§‰í˜”ë˜ ì¼ì´ í’€ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ ì°½ê°€ì—ì„œ í–‡ë¹›ì„ ë°›ìœ¼ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤.',
      FIRE: 'í™”(ç«)ê¸°ìš´ì„ ë³´ì¶©í•˜ë©´ ì—´ì •ê³¼ ì¶”ì§„ë ¥ì´ ê°•í™”ë©ë‹ˆë‹¤. ì´ ë°©ì—ì„œ ìš©ê¸°ë¥¼ ì–»ê³ , ë¯¸ë¤„ë’€ë˜ ì¼ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ëœ»í•œ ì°¨ë¥¼ ë§ˆì‹œë©° ê¸ì •ì ì¸ ìƒê°ì„ í•˜ë©´ ìš´ê¸°ê°€ ìƒìŠ¹í•©ë‹ˆë‹¤.',
      EARTH: 'í† (åœŸ)ê¸°ìš´ì„ ë³´ì¶©í•˜ë©´ ì•ˆì •ê°ê³¼ ì‹ ë¢°ê°ì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ì´ ë°©ì—ì„œ ë§ˆìŒì´ í¸ì•ˆí•´ì§€ê³ , ê¹Šì€ íœ´ì‹ì„ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë‹¥ì— ì•‰ê±°ë‚˜ ëˆ„ì›Œ ëª…ìƒì„ í•˜ë©´ ëŒ€ì§€ì˜ ê¸°ìš´ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      METAL: 'ê¸ˆ(é‡‘)ê¸°ìš´ì„ ë³´ì¶©í•˜ë©´ íŒë‹¨ë ¥ê³¼ ì‹¤í–‰ë ¥ì´ í–¥ìƒë©ë‹ˆë‹¤. ì´ ë°©ì—ì„œ ë¨¸ë¦¬ê°€ ë§‘ì•„ì§€ê³ , ì˜¬ë°”ë¥¸ ê²°ì •ì„ ë‚´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë¦¬ì •ëˆì„ í•˜ê±°ë‚˜ ê³„íšì„ ì„¸ìš°ë©´ ê¸ˆê¸°ìš´ì´ ë”ìš± ê°•í™”ë©ë‹ˆë‹¤.',
      WATER: 'ìˆ˜(æ°´)ê¸°ìš´ì„ ë³´ì¶©í•˜ë©´ ì§€í˜œì™€ í†µì°°ë ¥ì´ ê¹Šì–´ì§‘ë‹ˆë‹¤. ì´ ë°©ì—ì„œ ë³µì¡í•œ ë¬¸ì œì˜ í•´ë‹µì„ ì°¾ê±°ë‚˜, ìƒˆë¡œìš´ ê´€ì ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©° ê¹Šì€ ì‚¬ìƒ‰ì— ì ê¸°ë©´ ìˆ˜ê¸°ìš´ì´ ì±„ì›Œì§‘ë‹ˆë‹¤.'
    };

    const DAILY_FORTUNES = {
      WOOD: {
        love: { stars: 4, message: 'ìƒˆë¡œìš´ ì¸ì—°ì˜ ì‹œì‘. ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ì´ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.' },
        career: { stars: 5, message: 'ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¡œ ì„±ì¥ì˜ ê¸°íšŒë¥¼ ì¡ìœ¼ì„¸ìš”.' },
        money: { stars: 3, message: 'ì‘ì€ íˆ¬ìê°€ í° ë‚˜ë¬´ë¡œ ìë„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' }
      },
      FIRE: {
        love: { stars: 5, message: 'ì—´ì •ì´ ë„˜ì¹˜ëŠ” í•˜ë£¨. ì ê·¹ì ì¸ í–‰ë™ì´ ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.' },
        career: { stars: 4, message: 'ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ì ˆí˜¸ì˜ ê¸°íšŒì…ë‹ˆë‹¤.' },
        money: { stars: 4, message: 'ì¶”ì§„ë ¥ ìˆëŠ” ê²°ì •ì´ ì¬ë¬¼ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.' }
      },
      EARTH: {
        love: { stars: 3, message: 'ì•ˆì •ì ì¸ ê´€ê³„ ë°œì „. ì‹ ë¢°ë¥¼ ìŒ“ëŠ” ì‹œê°„ì…ë‹ˆë‹¤.' },
        career: { stars: 4, message: 'ê¾¸ì¤€í•¨ì´ ë¹›ì„ ë°œí•©ë‹ˆë‹¤. ì°¨ê·¼ì°¨ê·¼ ë‚˜ì•„ê°€ì„¸ìš”.' },
        money: { stars: 5, message: 'ì°©ì‹¤í•œ ì €ì¶•ê³¼ íˆ¬ìë¡œ ì•ˆì •ì ì¸ ì¬ë¬¼ìš´.' }
      },
      METAL: {
        love: { stars: 3, message: 'ì›ì¹™ì„ ì§€í‚¤ë˜ ìœ ì—°í•¨ë„ í•„ìš”í•©ë‹ˆë‹¤.' },
        career: { stars: 5, message: 'ëª…í™•í•œ íŒë‹¨ìœ¼ë¡œ ì¤‘ìš”í•œ ê²°ì •ì„ ë‚´ë¦¬ê¸° ì¢‹ì€ ë‚ .' },
        money: { stars: 4, message: 'ì •í™•í•œ ë¶„ì„ì´ ì¬ë¬¼ì„ ì§€í‚µë‹ˆë‹¤.' }
      },
      WATER: {
        love: { stars: 4, message: 'ê¹Šì€ ëŒ€í™”ë¡œ ë§ˆìŒì´ í†µí•˜ëŠ” í•˜ë£¨ì…ë‹ˆë‹¤.' },
        career: { stars: 3, message: 'íë¦„ì„ ì½ê³  ì ì‘í•˜ëŠ” ì§€í˜œê°€ í•„ìš”í•©ë‹ˆë‹¤.' },
        money: { stars: 4, message: 'ìœ ì—°í•œ ëŒ€ì²˜ë¡œ ì˜ˆìƒì¹˜ ëª»í•œ ì¬ë¬¼ìš´ì´ ë“¤ì–´ì˜µë‹ˆë‹¤.' }
      }
    };

    let guests = [];
    let currentGuest = null;
    let matchResult = null;
    let calendarType = 'solar'; // 'solar' or 'lunar'

    // Initialize
    function init() {
      loadGuests();
      renderRooms();
      updateStats();
    }

    // Calendar type selection
    function selectCalendarType(type) {
      calendarType = type;
      document.getElementById('solarBtn').classList.remove('active');
      document.getElementById('lunarBtn').classList.remove('active');

      if (type === 'solar') {
        document.getElementById('solarBtn').classList.add('active');
      } else {
        document.getElementById('lunarBtn').classList.add('active');
      }
    }

    // Toggle time input based on "Unknown" checkbox
    function toggleTimeInput() {
      const checkbox = document.getElementById('timeUnknown');
      const hourInput = document.getElementById('birthHour');
      const minuteInput = document.getElementById('birthMinute');

      if (checkbox.checked) {
        hourInput.value = '';
        minuteInput.value = '';
        hourInput.disabled = true;
        minuteInput.disabled = true;
        hourInput.style.opacity = '0.5';
        minuteInput.style.opacity = '0.5';
      } else {
        hourInput.disabled = false;
        minuteInput.disabled = false;
        hourInput.style.opacity = '1';
        minuteInput.style.opacity = '1';
      }
    }

    // Storage functions
    function loadGuests() {
      const stored = localStorage.getItem('airbnb-guests');
      if (stored) {
        guests = JSON.parse(stored);
        // Migrate old data that doesn't have strongestElement
        guests = guests.map(guest => {
          if (!guest.saju.strongestElement) {
            // Recalculate to add strongestElement
            let maxElement = 'WOOD';
            let maxCount = 0;
            Object.entries(guest.saju.elementCount).forEach(([element, count]) => {
              if (count > maxCount) {
                maxCount = count;
                maxElement = element;
              }
            });
            guest.saju.strongestElement = maxElement;
          }
          return guest;
        });
        // Save migrated data
        saveGuests();
      }
    }

    function saveGuests() {
      localStorage.setItem('airbnb-guests', JSON.stringify(guests));
      updateStats();
    }

    // Saju calculation
    // ======== ì •ë°€ 4ì£¼ ê³„ì‚° (lunar-javascript ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ë°˜) ========
    const stems = ["ê°‘", "ì„", "ë³‘", "ì •", "ë¬´", "ê¸°", "ê²½", "ì‹ ", "ì„", "ê³„"];
    const branches = ["ì", "ì¶•", "ì¸", "ë¬˜", "ì§„", "ì‚¬", "ì˜¤", "ë¯¸", "ì‹ ", "ìœ ", "ìˆ ", "í•´"];

    // ì˜¤í–‰ ë§¤í•‘ (ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë°˜í™˜í•˜ëŠ” í•œì ì§€ì›)
    const stemElement = {
      "ê°‘": "WOOD", "ì„": "WOOD", "ë³‘": "FIRE", "ì •": "FIRE", "ë¬´": "EARTH", "ê¸°": "EARTH", "ê²½": "METAL", "ì‹ ": "METAL", "ì„": "WATER", "ê³„": "WATER",
      "ç”²": "WOOD", "ä¹™": "WOOD", "ä¸™": "FIRE", "ä¸": "FIRE", "æˆŠ": "EARTH", "å·±": "EARTH", "åºš": "METAL", "è¾›": "METAL", "å£¬": "WATER", "ç™¸": "WATER"
    };
    const branchElement = {
      "ì": "WATER", "í•´": "WATER", "ì¸": "WOOD", "ë¬˜": "WOOD", "ì‚¬": "FIRE", "ì˜¤": "FIRE", "ì‹ ": "METAL", "ìœ ": "METAL", "ì§„": "EARTH", "ìˆ ": "EARTH", "ì¶•": "EARTH", "ë¯¸": "EARTH",
      "å­": "WATER", "äº¥": "WATER", "å¯…": "WOOD", "å¯": "WOOD", "å·³": "FIRE", "åˆ": "FIRE", "ç”³": "METAL", "é…‰": "METAL", "è¾°": "EARTH", "æˆŒ": "EARTH", "ä¸‘": "EARTH", "æœª": "EARTH"
    };

    function getDailyFortune(dayGanZhi) {
      if (!dayGanZhi || dayGanZhi.length < 2) return null;

      const todaySolar = window.Solar.fromDate(new Date());
      const todayLunar = todaySolar.getLunar();
      const todayDayGanZhi = todayLunar.getDayInGanZhi();
      const todayStem = todayDayGanZhi[0];

      const userStem = dayGanZhi[0];
      const userElement = stemElement[userStem];
      const todayElement = stemElement[todayStem];

      // Define relationship (Sipsin) based on elements
      const elementOrder = ["WOOD", "FIRE", "EARTH", "METAL", "WATER"];
      const userIdx = elementOrder.indexOf(userElement);
      const todayIdx = elementOrder.indexOf(todayElement);

      // Relationship distance (0: Same, 1: Creation, 2: Control, 3: Over-control, 4: Support)
      const diff = (todayIdx - userIdx + 5) % 5;

      const sipsinPool = {
        0: { // Same (Bi-Gyeon/Geop-Jae): Social, Peer focus
          love: "ì¹œêµ¬ ê°™ì€ í¸ì•ˆí•œ ì¡°ì–¸ì´ í•„ìš”í•œ ë‚ ì…ë‹ˆë‹¤.",
          career: "ë™ë£Œë“¤ê³¼ í˜‘ë ¥í•  ë•Œ ì‹œë„ˆì§€ê°€ í¬ê²Œ ë°œìƒí•©ë‹ˆë‹¤.",
          money: "ì§€ì¶œë³´ë‹¤ëŠ” ì •ë³´ ê³µìœ ë¥¼ í†µí•œ ê¸°íšŒë¥¼ ì°¾ìœ¼ì„¸ìš”.",
          score: 3
        },
        1: { // Creation (Sik-Sang): Creativity, Expression
          love: "ë‚˜ì˜ ë§ˆìŒì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•˜ë©´ í–‰ìš´ì´ ë”°ë¦…ë‹ˆë‹¤.",
          career: "ìƒˆë¡œìš´ ì•„ì´ë””ì–´ê°€ ë‹ë³´ì—¬ ëŠ¥ë ¥ì„ ì¸ì •ë°›ìŠµë‹ˆë‹¤.",
          money: "ë‚˜ë¥¼ ìœ„í•œ íˆ¬ìê°€ ë¯¸ë˜ì˜ ì¬ë¬¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.",
          score: 4
        },
        2: { // Control (Jae-Seong): Wealth, Accomplishment
          love: "ê´€ê³„ë¥¼ ì£¼ë„ì ìœ¼ë¡œ ì´ëŒ ë•Œ ì¢‹ì€ ê²°ê³¼ê°€ ìƒê¹ë‹ˆë‹¤.",
          career: "ëª©í‘œí•œ ë°”ë¥¼ ëê¹Œì§€ ë°€ì–´ë¶™ì—¬ ì„±ì·¨í•˜ëŠ” ë‚ ì…ë‹ˆë‹¤.",
          money: "ì •í™•í•œ íŒë‹¨ìœ¼ë¡œ ì¬ë¬¼ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ê¸°íšŒì…ë‹ˆë‹¤.",
          score: 5
        },
        3: { // Controlled (Gwan-Seong): Discipline, Career
          love: "ë°°ë ¤ì™€ ì˜ˆì˜ê°€ ì„œë¡œì˜ ì‹ ë¢°ë¥¼ ê¹Šê²Œ ë§Œë“­ë‹ˆë‹¤.",
          career: "ì±…ì„ê° ìˆëŠ” ìì„¸ê°€ ì£¼ë³€ì˜ ì‹ ë§ì„ ì–»ê²Œ í•©ë‹ˆë‹¤.",
          money: "ì•ˆì „í•œ ê´€ë¦¬ì™€ ì ˆì•½ì´ ìµœìš°ì„ ì¸ í•˜ë£¨ì…ë‹ˆë‹¤.",
          score: 4
        },
        4: { // Support (In-Seong): Learning, Help
          love: "ìƒëŒ€ë°©ì˜ ë”°ëœ»í•œ ìœ„ë¡œê°€ í° í˜ì´ ë˜ëŠ” ë‚ ì…ë‹ˆë‹¤.",
          career: "ì„ ë°°ë‚˜ ìƒì‚¬ì˜ ë„ì›€ìœ¼ë¡œ ë¬¸ì œê°€ í•´ê²°ë©ë‹ˆë‹¤.",
          money: "ë¬¸ì„œë‚˜ ê³„ì•½ ê´€ë ¨í•˜ì—¬ ì¢‹ì€ ì†Œì‹ì´ ë“¤ë ¤ì˜µë‹ˆë‹¤.",
          score: 3
        }
      };

      const result = sipsinPool[diff];

      // Add slight randomness based on user's specific character to further differentiate
      const charSeed = userStem.charCodeAt(0) + new Date().getDate();
      const randomOffset = (charSeed % 3) - 1; // -1, 0, or 1

      return {
        todayPillar: todayDayGanZhi,
        love: { stars: Math.max(1, Math.min(5, result.score + randomOffset)), message: result.love },
        career: { stars: Math.max(1, Math.min(5, result.score)), message: result.career },
        money: { stars: Math.max(1, Math.min(5, result.score - randomOffset)), message: result.money }
      };
    }

    function calculateSaju(year, month, day, hour, minute = 0, timeUnknown = false) {
      if (!window.Solar || !window.Lunar) {
        throw new Error("ë§Œì„¸ë ¥ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì´ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }
      try {
        const h = parseInt(timeUnknown ? 12 : hour, 10) || 0;
        const m = parseInt(minute, 10) || 0;

        const solar = window.Solar.fromYmdHms(parseInt(year), parseInt(month), parseInt(day), h, m, 0);
        const lunar = solar.getLunar();

        // Use standard methods on Lunar object which are more stable
        const yearPillar = (typeof lunar.getYearInGanZhiByLiChun === 'function')
          ? lunar.getYearInGanZhiByLiChun()
          : (lunar.getYearInGanZhi ? lunar.getYearInGanZhi() : "");

        const monthPillar = (typeof lunar.getMonthInGanZhiBySection === 'function')
          ? lunar.getMonthInGanZhiBySection()
          : (lunar.getMonthInGanZhi ? lunar.getMonthInGanZhi() : "");

        const dayPillar = lunar.getDayInGanZhi ? lunar.getDayInGanZhi() : "";
        const hourPillar = timeUnknown ? "ëª¨ë¦„" : (lunar.getTimeInGanZhi ? lunar.getTimeInGanZhi() : "");

        const toKo = (ganZhi) => {
          if (!ganZhi || ganZhi === "ëª¨ë¦„") return ganZhi;
          const sIdx = "ç”²ä¹™ä¸™ä¸æˆŠå·±åºšè¾›å£¬ç™¸".indexOf(ganZhi[0]);
          const bIdx = "å­ä¸‘å¯…å¯è¾°å·³åˆæœªç”³é…‰æˆŒäº¥".indexOf(ganZhi[1]);
          return (sIdx !== -1 && bIdx !== -1) ? stems[sIdx] + branches[bIdx] : ganZhi;
        };

        const sajuText = {
          year: toKo(yearPillar),
          month: toKo(monthPillar),
          day: toKo(dayPillar),
          hour: hourPillar === "ëª¨ë¦„" ? "ëª¨ë¦„" : toKo(hourPillar)
        };

        const elementCount = { WOOD: 0, FIRE: 0, EARTH: 0, METAL: 0, WATER: 0 };

        const countPillarChars = (ganZhi) => {
          if (!ganZhi || ganZhi === "ëª¨ë¦„" || ganZhi.length < 2) return;
          const g = ganZhi[0], z = ganZhi[1];
          if (stemElement[g]) elementCount[stemElement[g]]++;
          if (branchElement[z]) elementCount[branchElement[z]]++;
        };

        countPillarChars(yearPillar);
        countPillarChars(monthPillar);
        countPillarChars(dayPillar);
        if (!timeUnknown) countPillarChars(hourPillar);

        let minElement = "WOOD", minCount = 99;
        Object.entries(elementCount).forEach(([el, count]) => {
          if (count < minCount) { minCount = count; minElement = el; }
        });

        let maxElement = "WOOD", maxCount = 0;
        Object.entries(elementCount).forEach(([el, count]) => {
          if (count > maxCount) { maxCount = count; maxElement = el; }
        });

        // Generate dynamic daily fortune based on today's energy
        const dailyFortune = getDailyFortune(dayPillar);

        return {
          pillars: sajuText,
          elementCount,
          missingElement: minElement,
          strongestElement: maxElement,
          strength: minCount === 0 ? "ë§¤ìš° ë¶€ì¡±" : "ë³´í†µ",
          dailyFortune
        };
      } catch (err) {
        console.error("Saju Calculation Error:", err);
        throw new Error("ì •ë°€ ì‚¬ì£¼ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + err.message);
      }
    }

    // View management
    function showView(viewName) {
      const views = document.querySelectorAll('.view');
      views.forEach(view => view.classList.remove('active'));

      document.getElementById(viewName).classList.add('active');

      const navButtons = document.querySelectorAll('.nav button');
      navButtons.forEach(btn => btn.classList.remove('active'));

      // Use event.currentTarget if available, or find the button by some other means if needed.
      // But for inline handlers, event.target or event.currentTarget might be tricky if not passed.
      // The original code used event.target.closest('button'). Let's stick to valid JS.
      if (window.event) {
        const target = window.event.target.closest('button');
        if (target) target.classList.add('active');
      }

      if (viewName === 'history') {
        renderHistory();
      }
    }

    // Render functions
    function renderRooms() {
      const grid = document.getElementById('roomsGrid');
      grid.innerHTML = Object.values(ROOMS).map(room => `
                <div class="room-card">
                    <div class="room-header" style="background: ${room.bgGradient}">
                        <div class="room-emoji">${room.image}</div>
                        <div class="room-element">
                            <span>${room.elementKo}</span>
                        </div>
                    </div>
                    <div class="room-body">
                        <div class="room-number">Room ${room.id}</div>
                        <div class="room-name">${room.nameKo}</div>
                        <div class="room-description">${room.description}</div>
                        <div class="room-features">
                            ${room.features.map(f => `<span class="feature-tag">${f}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
    }

    function updateStats() {
      document.getElementById('totalGuests').textContent = guests.length;
      document.getElementById('totalMatches').textContent = guests.length;
    }

    // Check-in
    function handleCheckIn() {
      const name = document.getElementById('guestName').value;
      const year = parseInt(document.getElementById('birthYear').value, 10);
      const month = parseInt(document.getElementById('birthMonth').value, 10);
      const day = parseInt(document.getElementById('birthDay').value, 10);
      const hour = parseInt(document.getElementById('birthHour').value, 10);
      const minute = parseInt(document.getElementById('birthMinute').value, 10) || 0;

      const timeUnknown = document.getElementById('timeUnknown').checked;

      if (!name || isNaN(year) || isNaN(month) || isNaN(day)) {
        alert('ì´ë¦„, ìƒë…„ì›”ì¼ì€ í•„ìˆ˜ ì •ë³´ì…ë‹ˆë‹¤.');
        return;
      }

      if (!timeUnknown && isNaN(hour)) {
        alert('ì¶œìƒ ì‹œê°„ì„ ì…ë ¥í•˜ê±°ë‚˜ "ì¶œìƒ ì‹œê°„ì„ ëª¨ë¥´ê² ì–´ìš”"ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // Validate input ranges
      if (year < 1900 || year > 2024) {
        alert('ìƒë…„ì€ 1900~2024 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      if (month < 1 || month > 12) {
        alert('ì›”ì€ 1~12 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      if (day < 1 || day > 31) {
        alert('ì¼ì€ 1~31 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      if (!timeUnknown && (hour < 0 || hour > 23)) {
        alert('ì‹œê°„ì€ 0~23 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      if (!timeUnknown && minute && (minute < 0 || minute > 59)) {
        alert('ë¶„ì€ 0~59 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }

      console.log('ì²´í¬ì¸ ì…ë ¥ê°’:', { name, year, month, day, hour, minute });

      // Lunar to Solar conversion if needed
      let solarYear = year;
      let solarMonth = month;
      let solarDay = day;

      if (calendarType === 'lunar') {
        try {
          // Use Lunar library to convert
          const lunar = window.Lunar.fromYmd(year, month, day);
          const solar = lunar.getSolar();

          solarYear = solar.getYear();
          solarMonth = solar.getMonth();
          solarDay = solar.getDay();

          console.log('ìŒë ¥â†’ì–‘ë ¥ ë³€í™˜:', {
            lunar: `${year}-${month}-${day}`,
            solar: `${solarYear}-${solarMonth}-${solarDay}`
          });
        } catch (error) {
          console.error('Lunar conversion error:', error);
          alert('ìŒë ¥ ë‚ ì§œ ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‚ ì§œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
          return;
        }
      }

      try {
        const sajuResult = calculateSaju(solarYear, solarMonth, solarDay, timeUnknown ? null : hour, timeUnknown ? null : minute, timeUnknown);

        if (!sajuResult || !sajuResult.missingElement) {
          throw new Error('ì‚¬ì£¼ ê³„ì‚° ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }

        const recommendedRoom = Object.values(ROOMS).find(
          room => room.element === sajuResult.missingElement
        );

        if (!recommendedRoom) {
          throw new Error('ì¶”ì²œ ê°ì‹¤ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + sajuResult.missingElement);
        }

        const guest = {
          id: Date.now(),
          name: name,
          birth: { year, month, day, hour: timeUnknown ? null : hour, minute: timeUnknown ? null : minute },
          calendarType: calendarType,
          solarDate: calendarType === 'lunar' ? { year: solarYear, month: solarMonth, day: solarDay } : null,
          checkInDate: new Date().toISOString(),
          saju: sajuResult,
          recommendedRoom: recommendedRoom.id,
          visits: 1
        };

        guests.push(guest);
        saveGuests();

        currentGuest = guest;
        matchResult = {
          guest,
          room: recommendedRoom,
          welcome: WELCOME_ITEMS[sajuResult.missingElement]
        };

        // Clear form
        document.getElementById('guestName').value = '';
        document.getElementById('birthYear').value = '';
        document.getElementById('birthMonth').value = '';
        document.getElementById('birthDay').value = '';
        document.getElementById('birthHour').value = '';
        document.getElementById('birthMinute').value = '';

        showResult();
      } catch (error) {
        console.error('Check-in Error:', error);
        alert('ì²´í¬ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
      }
    }

    // Show result
    function showResult() {
      const { guest, room, welcome } = matchResult;

      document.getElementById('resultGuestName').textContent = `${guest.name}ë‹˜ì„ ìœ„í•œ ë§ì¶¤ ê°ì‹¤`;

      // Render Saju Analysis
      renderSajuAnalysis(guest, room);

      const showcase = document.getElementById('roomShowcase');
      showcase.style.background = room.bgGradient;

      document.getElementById('roomShowcaseEmoji').textContent = room.image;
      document.getElementById('roomShowcaseNumber').textContent = `Room ${room.id}`;
      document.getElementById('roomShowcaseName').textContent = room.nameKo;
      document.getElementById('roomShowcaseElement').textContent = `${room.elementKo} ${room.element}`;

      const calendarTypeText = guest.calendarType === 'solar' ? 'ì–‘ë ¥' : 'ìŒë ¥';
      const birthMinute = guest.birth.minute || 0;
      const timeText = `${String(guest.birth.hour).padStart(2, '0')}:${String(birthMinute).padStart(2, '0')}`;

      const pillars = (guest.saju && guest.saju.pillars) || { year: '-', month: '-', day: '-', hour: '-' };

      document.getElementById('matchingReason').innerHTML = `
                ${guest.name}ë‹˜ì˜ ì‚¬ì£¼ (<strong>${calendarTypeText}</strong> ${guest.birth.year}ë…„ ${guest.birth.month}ì›” ${guest.birth.day}ì¼ ${timeText})ë¥¼ ì •ë°€ ë¶„ì„í•œ ê²°ê³¼, 
                <strong>${room.elementKo}(${room.element})</strong> ê¸°ìš´ì´ 
                <strong>${guest.saju.strength}</strong>í•©ë‹ˆë‹¤. 
                ì´ ë°©ì€ ë¶€ì¡±í•œ ê¸°ìš´ì„ ë³´ì™„í•˜ê³  ê· í˜•ì„ ë§ì¶°ë“œë¦½ë‹ˆë‹¤.
            `;

      const featuresList = document.getElementById('roomFeaturesList');
      featuresList.innerHTML = room.features.map(f => `
                <li>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                    ${f}
                </li>
            `).join('');

      document.getElementById('welcomeTea').textContent = welcome.tea;
      document.getElementById('welcomeAroma').textContent = welcome.aroma;
      document.getElementById('welcomeActivity').textContent = welcome.activity;
      document.getElementById('welcomeDirection').textContent = `ë¨¸ë¦¬ë¥¼ ${welcome.direction} ë°©í–¥ìœ¼ë¡œ`;
      document.getElementById('welcomeColor').textContent = welcome.color;
      document.getElementById('welcomeTip').textContent =
        `ì²´í¬ì¸ í›„ ë°©ì—ì„œ ${welcome.activity}ë¥¼ í•˜ì‹œë©´ ë”ìš± í¸ì•ˆí•œ íœ´ì‹ì„ ì·¨í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;

      document.getElementById('result').classList.add('active');
      document.getElementById('checkin').classList.remove('active');
    }

    // Render Saju Analysis
    function renderSajuAnalysis(guest, room) {
      const { elementCount, missingElement, strongestElement } = guest.saju;

      // Ensure strongestElement exists (for backward compatibility with old data)
      const safeStrongestElement = strongestElement || missingElement;

      // Hide the detailed element chart as requested
      const elementChart = document.getElementById('elementChart');
      if (elementChart) elementChart.style.display = 'none';

      // Re-populate analysis details
      // Render personality (with safety checks)
      const personalityData = ELEMENT_PERSONALITIES[safeStrongestElement] || ELEMENT_PERSONALITIES['WOOD'];
      const missingData = ELEMENT_PERSONALITIES[missingElement] || ELEMENT_PERSONALITIES['WOOD'];

      document.getElementById('personalityText').innerHTML = `
                ${personalityData.strong} 
                <br><br>
                ë‹¤ë§Œ, ${missingData.weak} 
                <strong>${room.nameKo}</strong>ì—ì„œì˜ ìˆ™ë°•ì€ ì´ëŸ¬í•œ ë¶€ë¶„ì„ ë³´ì™„í•˜ê³  ì˜¤í–‰ì˜ ê· í˜•ì„ ë§ì¶°ì¤„ ê²ƒì…ë‹ˆë‹¤.
            `;

      // Render fortune cards
      const fortunes = FORTUNE_MESSAGES[missingElement] || FORTUNE_MESSAGES['WOOD'];
      const fortuneCards = document.getElementById('fortuneCards');
      fortuneCards.innerHTML = Object.values(fortunes).map(fortune => `
                <div class="fortune-card">
                    <div class="fortune-icon">${fortune.icon}</div>
                    <div class="fortune-label">${fortune.label}</div>
                    <div class="fortune-value">${fortune.value}</div>
                </div>
            `).join('');

      // Render balance tip
      document.getElementById('balanceTip').textContent = BALANCE_TIPS[missingElement] || BALANCE_TIPS['WOOD'];

      // Render dynamic daily fortune
      const dailyFortune = guest.saju.dailyFortune;

      if (dailyFortune) {
        const renderStars = (count) => {
          return 'â˜…'.repeat(count) + 'â˜†'.repeat(5 - count);
        };

        document.getElementById('loveStars').textContent = renderStars(dailyFortune.love.stars);
        document.getElementById('loveMessage').textContent = dailyFortune.love.message;

        document.getElementById('careerStars').textContent = renderStars(dailyFortune.career.stars);
        document.getElementById('careerMessage').textContent = dailyFortune.career.message;

        document.getElementById('moneyStars').textContent = renderStars(dailyFortune.money.stars);
        document.getElementById('moneyMessage').textContent = dailyFortune.money.message;

        // Add current date and pillar to the fortune section title if needed
        const fortuneTitle = document.querySelector('.fortune-title');
        if (fortuneTitle) {
          const today = new Date();
          fortuneTitle.innerHTML = `ì˜¤ëŠ˜ì˜ ìš´ì„¸ <span style="font-size: 0.8rem; font-weight: normal; opacity: 0.7; margin-left: 10px;">(${today.getMonth() + 1}/${today.getDate()} ${dailyFortune.todayPillar}ì¼)</span>`;
        }
      }
    }

    // History
    function renderHistory() {
      const list = document.getElementById('historyList');

      if (guests.length === 0) {
        list.innerHTML = `
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <p>ë“±ë¡ëœ ê²ŒìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
        return;
      }

      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filtered = guests.filter(g => g.name.toLowerCase().includes(searchTerm));

      list.innerHTML = filtered.map(guest => {
        const room = ROOMS[guest.recommendedRoom];
        const calendarTypeText = guest.calendarType === 'solar' ? 'ì–‘ë ¥' : 'ìŒë ¥';
        const birthMinute = guest.birth.minute || 0;
        const birthInfo = `${calendarTypeText} ${guest.birth.year}.${guest.birth.month}.${guest.birth.day} ${String(guest.birth.hour).padStart(2, '0')}:${String(birthMinute).padStart(2, '0')}`;

        return `
                    <div class="history-item" onclick="viewGuestAnalysis(${guest.id})">
                        <div class="history-guest">
                            <div class="history-avatar">${guest.name[0]}</div>
                            <div class="history-info">
                                <div class="history-name">${guest.name}</div>
                                <div class="history-date">
                                    ${birthInfo}
                                </div>
                                <div class="history-date">
                                    ì²´í¬ì¸: ${new Date(guest.checkInDate).toLocaleDateString('ko-KR')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="history-room">
                            <div class="history-room-badge" style="background: ${room.bgGradient}">
                                <span>Room ${room.id}</span>
                            </div>
                            <div class="history-room-name">${room.nameKo}</div>
                        </div>
                        
                        <div class="history-element">
                            <div class="element-label">ë¶€ì¡±í•œ ê¸°ìš´</div>
                            <div class="element-badge">
                                ${room.elementKo}
                            </div>
                        </div>
                        
                        <div class="view-analysis-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"/>
                            </svg>
                        </div>
                    </div>
                `;
      }).join('');
    }

    function filterGuests() {
      renderHistory();
    }

    // View guest analysis from history
    function viewGuestAnalysis(guestId) {
      const guest = guests.find(g => g.id === guestId);
      if (!guest) return;

      const room = ROOMS[guest.recommendedRoom];
      const welcome = WELCOME_ITEMS[guest.saju.missingElement];

      currentGuest = guest;
      matchResult = {
        guest,
        room,
        welcome
      };

      showResult();
    }

    // Initialize on load
    window.onload = init;
  </script>
</body>

</html>